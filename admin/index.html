<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/">
    <title>Officer Dashboard | Luntian Wonders</title>
    <link rel="icon" type="image/png" href="images/lwowhite.png">
    <link rel="shortcut icon" href="images/lwowhite.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/lwowhite.png">
    <meta name="theme-color" content="#064e3b">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&family=Merriweather:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Merriweather', serif; background-color: #f1f5f9; color: #0f172a; }
        h1, h2, h3, h4, .font-heading { font-family: 'Montserrat', sans-serif; }
    </style>
</head>
<body class="flex min-h-screen">

    <aside class="w-64 bg-slate-900 text-white flex flex-col fixed h-full z-20">
        <div class="p-6 flex items-center gap-3 border-b border-slate-800">
            <img src="images/logo.png" alt="Luntian Wonders Logo" onerror="this.src='https://placehold.co/40x40'" class="h-8 w-auto">
            <div>
                <!-- content omitted -->
            </div>
        </div>
        
        <nav class="flex-grow p-4 space-y-2">
            <a href="#" class="flex items-center gap-3 px-4 py-3 bg-emerald-600 rounded-lg text-white font-bold text-sm shadow-lg">
                <!-- content omitted -->
            </a>
        </nav>

        <div class="p-4 border-t border-slate-800">
            <a href="/login" class="flex items-center gap-2 text-red-400 text-xs font-bold hover:text-red-300">
                <!-- content omitted -->
            </a>
        </div>
    </aside>

    <main class="flex-1 ml-64 p-8">
        <header class="flex justify-between items-center mb-8">
            <div>
                <!-- content omitted -->
            </div>
            <div class="flex items-center gap-4">
                <!-- content omitted -->
            </div>
        </header>

        <div class="grid grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <!-- content omitted -->
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                <h3 class="font-heading font-bold">Volunteer Registrations</h3>
                <div class="text-sm text-slate-500">Pending: <span id="pending-count" class="font-bold">0</span></div>
            </div>
            <table class="w-full text-left border-collapse">
                <thead class="bg-slate-50">
                    <tr>
                        <th class="px-6 py-3 text-sm font-semibold">Name</th>
                        <th class="px-6 py-3 text-sm font-semibold">Event</th>
                        <th class="px-6 py-3 text-sm font-semibold">Status</th>
                        <th class="px-6 py-3 text-sm font-semibold text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="volunteer-table">
                    <tr id="no-pending" class="text-slate-500">
                        <td colspan="4" class="px-6 py-4 text-sm">No pending volunteers.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <script>
        // Simple admin-side volunteer management using localStorage
        document.addEventListener("DOMContentLoaded", function () {
            const VOLUNTEERS_KEY = 'lwt_volunteers';
            const legacyPendingKey = 'event-joined-001';
            const legacyNameKey = 'volunteer-name';

            const tableBody = document.getElementById('volunteer-table');
            const pendingCountEl = document.getElementById('pending-count');

            function loadVolunteers() {
                // migrate legacy single-pending keys if present
                let volunteers = JSON.parse(localStorage.getItem(VOLUNTEERS_KEY) || '[]');
                const legacyStatus = localStorage.getItem(legacyPendingKey);
                if (legacyStatus) {
                    volunteers.push({
                        id: Date.now().toString(),
                        name: localStorage.getItem(legacyNameKey) || 'Anonymous Volunteer',
                        eventId: legacyPendingKey,
                        status: 'pending',
                        createdAt: new Date().toISOString()
                    });
                    localStorage.removeItem(legacyPendingKey);
                    localStorage.removeItem(legacyNameKey);
                    localStorage.setItem(VOLUNTEERS_KEY, JSON.stringify(volunteers));
                }
                return volunteers;
            }

            function saveVolunteers(volunteers) {
                localStorage.setItem(VOLUNTEERS_KEY, JSON.stringify(volunteers));
            }

            function render() {
                const volunteers = loadVolunteers();
                const pending = volunteers.filter(v => v.status === 'pending');

                // clear rows
                tableBody.innerHTML = '';
                if (!pending.length) {
                    tableBody.innerHTML = '<tr id="no-pending" class="text-slate-500"><td colspan="4" class="px-6 py-4 text-sm">No pending volunteers.</td></tr>';
                } else {
                    pending.forEach(v => {
                        const tr = document.createElement('tr');
                        tr.className = 'border-t';
                        tr.innerHTML = `
                            <td class="px-6 py-4 text-sm">${escapeHtml(v.name)}</td>
                            <td class="px-6 py-4 text-sm">${escapeHtml(v.eventId)}</td>
                            <td class="px-6 py-4 text-sm"><span class="px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800">Pending</span></td>
                            <td class="px-6 py-4 text-sm text-right">
                                <button onclick="approveVolunteer('${v.id}')" class="bg-emerald-600 text-white px-3 py-1 rounded-md text-sm mr-2">Approve</button>
                                <button onclick="denyVolunteer('${v.id}')" class="bg-red-500 text-white px-3 py-1 rounded-md text-sm">Deny</button>
                            </td>
                        `;
                        tableBody.appendChild(tr);
                    });
                }

                pendingCountEl.textContent = pending.length;
            }

            // simple XSS-safe text escape
            function escapeHtml(str) {
                return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[s]);
            }

            // global functions used by inline onclick
            window.approveVolunteer = function (id) {
                const volunteers = loadVolunteers();
                const idx = volunteers.findIndex(v => v.id === id);
                if (idx === -1) return;
                volunteers[idx].status = 'approved';
                volunteers[idx].approvedAt = new Date().toISOString();
                saveVolunteers(volunteers);
                render();
                showToast(`${volunteers[idx].name} approved.`);
            };

            window.denyVolunteer = function (id) {
                let volunteers = loadVolunteers();
                const idx = volunteers.findIndex(v => v.id === id);
                if (idx === -1) return;
                const name = volunteers[idx].name;
                volunteers.splice(idx, 1); // remove denied
                saveVolunteers(volunteers);
                render();
                showToast(`${name} denied.`, 'red');
            };

            function showToast(message, color = 'green') {
                const toast = document.createElement('div');
                toast.className = `fixed top-6 right-6 z-50 px-4 py-2 rounded shadow text-white ${color === 'green' ? 'bg-emerald-600' : 'bg-red-500'}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.add('opacity-0'), 2200);
                setTimeout(() => toast.remove(), 2600);
            }

            // initial render
            render();
        });
    </script>
</body>
</html>